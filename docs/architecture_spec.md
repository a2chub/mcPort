# アーキテクチャ仕様

MC-Portは単一マシン上で稼働する軽量なポート管理サービスです。主な構成要素とそれぞれの
役割を以下に示します。

## コンポーネント

- **MC-Portデーモン**
  - ポート割り当てAPIとサービス登録APIを提供する常駐プロセス。
  - 割り当てたポートとサービス情報を永続ストアへ保存し、再起動時に復元する。
- **クライアントライブラリ**
  - MCPサーバーからの要求を簡易化するためのラッパーライブラリ。
  - `allocate`/`register`/`release`各エンドポイントへの通信を担当する。
- **データストア**
  - JSONファイルもしくはSQLiteを利用して状態を保持する。
  - 割り当て済みポートや登録サービスの一覧を永続化する。
- **設定ファイル**
  - YAML形式でポート範囲やデータ保存先を指定する。

## 処理の流れ

1. MCPサーバーは起動時にクライアントライブラリを通じて`/allocate`を呼び出す。
2. デーモンはポート範囲から空きポートを選択し、割り当て後ストアへ記録する。
3. ポートを受け取ったMCPサーバーは起動し、`/register`でサービス情報を登録する。
4. ユーザーは管理ツールまたはAPI経由で`/services`を参照し、現在登録されているサービ
   ス一覧を取得する。
5. サーバー終了時には`/release`を呼び出してポートを解放し、ストアの状態を更新する。

## デプロイモデル

MC-Portは基本的に単一ノード内で完結するサービスであり、クラスタリング機能は持ち
ません。必要に応じてsystemdサービスとして常駐させ、ログは標準ログローテーション
機能を利用します。

## 今後の拡張候補

- 複数ノードでの共有を想定したREST APIの認証・認可機能の追加
- Webダッシュボードからのサービス状態確認
- 割り当てポートの利用統計収集
