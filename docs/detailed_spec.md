# 詳細仕様

本章ではMC-Portの主要機能をより細かく定義します。実装時のインタフェース設計や
データフォーマットの参考となる情報をまとめています。

## ポート割り当て API
- **エンドポイント**: `POST /allocate`
- **リクエスト**: 空のJSONもしくはオプション指定用のパラメータ
- **レスポンス**:
  ```json
  {
    "port": 20010
  }
  ```
- **処理詳細**:
  1. 設定ファイルで定義されたポート範囲を走査し、`bind`可能かチェックする。
  2. 使用可能なポートを見つけたら割り当てリストに登録し、レスポンスとして返す。
  3. 失敗した場合はHTTP 503とエラーメッセージを返す。

## サービス登録 API
- **エンドポイント**: `POST /register`
- **リクエスト**:
  ```json
  {
    "port": 20010,
    "service_name": "example",
    "description": "サンプルサーバー"
  }
  ```
- **レスポンス**: 登録成功時はHTTP 200、失敗時は理由に応じて400/500系コード
- **処理詳細**:
  1. 指定ポートが既に割り当て済みか確認する。
  2. サービス情報をストアに追加し、重複がないか検証する。

## ポート解放 API
- **エンドポイント**: `POST /release`
- **リクエスト**:
  ```json
  {
    "port": 20010
  }
  ```
- **処理詳細**:
  1. 登録リストから該当ポートを削除し、ストアを更新する。
  2. 存在しないポートが指定された場合は404を返す。

## サービス一覧取得 API
- **エンドポイント**: `GET /services`
- **レスポンス例**:
  ```json
  [
    {
      "port": 20010,
      "service_name": "example",
      "description": "サンプルサーバー"
    }
  ]
  ```

## データ保存形式
JSONファイルの場合のレコード例を以下に示します。
```json
{
  "port": 20010,
  "service_name": "example",
  "description": "サンプルサーバー",
  "lease_time": null
}
```
データは配列として保存され、起動時にメモリへ読み込まれます。
